# 去噪方法

## 高斯白噪声去噪

## 真实噪声去噪
#### DRDN: Dynamic Residual Dense Network for Image Denoising
- 简介

  基于RDN（residual dense network）网络，RDB网络同通过级联多个RDBs（residual dense blocks）去充分利用多级特征。然而RDN只在单一的噪声等级上生效，RDN随着RDB的数量增多，计算量会显著增加，只会提高少量性能。
  
  本文在RDB的基础上，加入了判断跳跃模块，对于每个RDBs进行判断，不重要则跳过，节省计算量，重要则进行计算。并且可以通过手动调整判断阈值的方法来调节网络去噪力度
  
- 算法原理
	- 实验理论
	
	  文章作者通过可视化RDN网络中RDBs的输出特征图(不同通道特征图的平均值作为可视化结果输出)，发现一些相邻的特征图具有相似性，意味着RDBs是冗余的，故可通过修剪不必要的RDB减少计算量。而对于需要修剪的模块通过网络判断
	  
	- 网络结构
		
		训练时，当门模块输出为0时，对应的RDB不更新权重，门模块输出为1时，才更新权重。而无论门模块输出是什么，门模块内权重均更新。
		推断时，由于网络仅执行前向传播，因此如果门模块的输出为0，则无需获取残差稠密块的输出。我们可以收集所有门模块的输出以计算残差块跳过的数量。 我们计算被跳过的块与总块的比率，这称为跳过比率。同时，可以通过**修改阈值t来改变跳过率和网络的去噪强度**。但是，由于阈值和跳过率不一致，因此我们使用简单的线性变换将阈值映射到跳过率：
		$$t = \omega \lambda+(1-\omega)\epsilon$$
		
	- 训练策略
	   
	   损失函数定义为：
	   
	   $$L = ||y-y_p||_1+\alpha \frac{1}{N}\sum_{d=1}^{N} {S_d(V_d)}$$
	   
	   其中$S_d(V_d)$为门电路输出，N为门电路个数，y为label，yp为网络输出
	   
	  1. 由于gate模块梯度传播的影响，需要简单的对DRDB进行预训练，以保证其具有去噪能力。先固定所有的gate模块为1，然后使用orthogonal matrix初始化卷积层参数。设置$\alpha$为0，因为gate模块不会参与决策
	  2. 解除gate模块的固定，先初始化为一个接近0的值。在这一过程，让gate学习到提取有用的信息的能力。DRDN也可以进行二分决策
	  3. 设置 $\alpha$为1e-4，让gate模块跳过更多的不重要的块。这时候我们没有有效引导gate做决策，因此这里需要激活loss函数的正则项，直接约束gate模块的输出。在这个步骤中，在skip ratio稳定后，学习率需要设置到更小，可以让模型获得更好的去噪能力
	  4. (可选)Optional。作者还用强化学习作为第4个stage来训练gate模块，以进一步提高skip ratio。但是，在作者的实验中，强化学习可能会稍微恶化结果，并通过调整阈值来限制网络更改降噪强度的能力。相反，DRDN可以通过强化学习获得更高的跳过率。因此，作者将此阶段视为可选的训练阶段。
	  
参考：https://zhuanlan.zhihu.com/p/87096400
## 盲去噪


## 其他
#### Noise2Noise
- **思想**
  训练去噪模型无需干净的目标图，可以用带噪图代替。即网络通过两张同时获取的同噪声分布的噪声图(如连续短曝光两次获取)，训练得到与干净目标图同样的效果。
- **理论依据**
	- 最小化损失
	  
	  对于一系列不可靠观测值($y_1$，$y_2$，...)，输出预测值z，最小化损失函数如下：
	  $${\underset {z}{\operatorname {arg\,min} }}\,E_y={L(z,y)}$$
	  对于L2损失，最小化结果是观测值的算数平均值；L1损失，是观测值的中位数；
	  
	- 网络表现
	  
	  对于普通的回归任务来说，输入与输出之间不是简单的1：1映射，而是一对多映射。例如：超分中，一个低分辨率图片可能映射为多种不同的高分辨率图片。

	  基于最小化损失的理论，使用L2损失训练一个回归神经网络，输入低分辨率图片，输出的高分辨率图片是所有可能输出的平均结果
	
	- 应用延伸
	
		基于以上的损失与网络的理论，在使用L2损失时，用与目标期望相同的随机数代替，不影响网络的训练效果(取决于样本数)
		
		- 去噪	
		
			用零均值的噪声图代替干净的目标图，不影响网络效果

		- HDR
		
			此处没看懂，涉及HDR图片去噪的损失选择

		对于有限数据，输出方差为目标损坏的平均方差除以样本数，所以样本越多，带噪目标图的结果越接近于干净目标图结果。

![enter image description here](dog)




[dog]:data:image/jpeg;base64,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


<!--stackedit_data:
eyJoaXN0b3J5IjpbLTk3OTMzNzIsMTIzNTE0NjQyMiwxMDIxMj
IxMjQsLTE5MDMyNzIyNTUsNDUwOTkwNDg4LDQ1MDk5MDQ4OCwx
ODgzMzI0NzI4LDk5ODAyMTQ4NiwxNjQzNzQ3NzgyLC0xMTQzMz
M5MzMyLDE3NTExMTAyMjMsLTIxMTYyMDcxODksLTI2NjYxMjI4
NiwzOTM3NzA5NzQsLTEwMzU1NzMzNDMsNjg1NDMyMjUwLDIxMT
cxMTI4NzMsLTE5NTE4MTc0MzYsLTE0MTYzNDIzNzUsLTEwMjE3
OTQ5MjFdfQ==
-->