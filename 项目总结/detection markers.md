## Detection markers

### 数据
- 原图  
  原图数据为16位的short型数据，图像大小1024x1024。
  - int 255  
    将原图每一张分别进行标准化，截取-0.75，0.75范围的数据（data2）,再进行最大最小值归一化到0，255范围，并`cv.cvtColor(img,cv.COLOR_GRAY2BGR)`成三通道
  - -0.75，0.75  
    将原图进行标准化，截取-0.75，0.75范围的数据--（data3）
  - 0，1
    将原图直接除以（256*256）,映射到（0，1）范围--（data4）
   
-   png图片
  输入直接是原图经过窗位窗宽调整过后的png图片图像大小1024x1024。

### 注意  
金标检测的图像分为png和原图，png是原图经过窗位窗宽调整后得到的图片，为uint8格式，而原图为16位图。
一般都是对原图进行一定范围的截取，然后将该范围的值映射到一定范围，用该范围的值对应全部灰阶成为的图像。

### 问题
1. opencv uint8格式问题  
   255的image和label读取进来除以255进行归一化，再放入网络训练。  
   输入的image除以255归一化后格式变成了float。
   - image
	   - 错误  
	     1. 直接乘以255后无法直接运用opencv。  
	     2. 先astype成uint8格式再乘以255
	   - 正确  
	     需要先对除以255后的对象，乘以255后，再astype成uint8格式才可以。
    - 输出  
        - 错误  
          1. 直接乘以255后无法直接运用opencv。  
          2. 先乘以255再astype成uint8格式
        - 正确  
          先astype成uint8格式再乘以255  
    - 以上这两者原因还待深究
2. 原图问题  
   - 差别小，导致肉眼无法识别的金标。
   - 金标小，小物体分割。
   - loss不同，导致结果不同。dice目标更准确完整，但背景更多噪声。MSE背景更干净，但目标不太完整，有许多孔洞。


### 总结  
**深度学习方法分割帧内透视图像中任意形状基准标记**  
- 目的  
  实时图像引导自适应放射治疗(IGART)需要精确的标记分割来解决基于二维透视图像的三维运动问题。该跟踪系统采用卷积神经网络(CNN)模型对**圆柱状和任意形状**的基准标记进行分割。  
  - 与传统方法相比  
    大多数常用的标记分割方法都需要事先了解标记属性才能构造模板。如果不知道标记物的属性，则需要额外的学习时间来构建将患者暴露于额外成像剂量的模板。该方法不需要预先特定于患者的数据或额外的学习时间。  
    目前很多分割方法都是基于模板匹配的，需要标记的先验信息。通常对于规则形状的标记(例如球形和圆柱形的金基准)，模板是基于已知的属性(如尺寸)构建的。其他类型的标记物如螺旋标记物(如Visicoil、IBA剂量学)可用于减少迁移，但这些标记物植入后会变形为任意形状，导致标记物性质未知。因此，需要额外的学习时间来确定标记属性和开发模板。而不同的模板选择会带来不必要的麻烦，对于圆柱形标记，通常使用CBCT投影作为模板学习数据。对于任意形状的标记，需要4 - 5个具有合理角度分离的投影来生成模板。这个学习阶段的缺点是由于额外的成像剂量而使病人遭受不必要的辐射。为了解决这些问题，一个不需要预先了解标记特性或额外学习时间的系统将对患者有益。
- 数据  
  标记图像是患者的单帧CT图像。  
  训练集由17位肝癌患者的标记植入的单帧CBCT图像构成。每位患者包含128张单帧CT图像。
	- 数据裁剪  
	  一种是将数据调整窗位窗宽，得到可视的标记图像。  
	  另一种是不经窗位窗宽的裁剪，直接将数据输入，进行标记位置分割。
	- 对图像进行最大最小值归一化
- 要点  
  适用于任意形状的标记，不需要事先知道标记的特性。不需要生成额外的模板，因此不需要额外学习时间获得标记属性以及开发模板。
  **实时**图像引导自适应放射治疗(IGART)跟踪目标
- 分割后图像求目标区域连通域，从而得到质心。
- 额外要点  
  - 可以用迁移学习   
    使用预先训练的Alexnet  (或者VGG)
    在医学领域使用深度学习CNNs的主要限制是缺乏大型带注释的数据集，比如那些为自然图像而存在的数据集。因此，在大型数据集上对CNNs进行全面培训的另一种选择是通过将预先培训好的CNNs微调到医疗应用程序来执行转移学习
<!--stackedit_data:
eyJoaXN0b3J5IjpbNDM3MTc1NTc4LC0xMTgwMzczMTkwLC02OT
UxODczNDEsMTExNTA5MzQyNyw2NzQwNTkyNjcsLTE1NjAyMjA2
OTAsLTEyMzQ3NzQxMzQsMTAxMTAwNjExNSwxMjcwMjA0MDA5LD
ExNDE4ODg0MjQsODg4NDczMiwtNDQzNjk1ODA5LDU3Njg0NTMy
MywxMTY5MzYzMDI0LC0xODExODczNTksNjY0OTg5MTk5LDE4Mz
U0MDA1OTMsLTEwNDk4Mjg2MTFdfQ==
-->